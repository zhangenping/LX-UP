<!--pages/user/profile.wxml-->
<view class="page-container">
  <!-- 用户信息卡片 -->
  <view class="user-card">
    <view class="user-info">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}"></image>
      <view class="user-detail">
        <text class="username">{{userInfo.nickName || '微信用户'}}</text>
        <view class="role-container">
          <text class="user-role {{userRole === 'teacher' ? 'teacher-role' : 'student-role'}}">
            {{userRole === 'teacher' ? '教师' : '学员'}}
          </text>
          <!-- 待审核标识 -->
          <text class="pending-badge" wx:if="{{userRole === 'teacher' && userStatus === 'pending'}}">
            待审核
          </text>
          <!-- 已认证标识 -->
          <text class="approved-badge" wx:if="{{userRole === 'teacher' && userStatus === 'approved'}}">
            已认证
          </text>
        </view>
      </view>
    </view>
    <view class="stats">
      <view class="stat-item" bindtap="goToSubscriptions">
        <text class="stat-value">{{subscriptionCount}}</text>
        <text class="stat-label">已订阅</text>
      </view>
      <view class="stat-item" bindtap="goToVerifyCodes">
        <text class="stat-value">{{verifyCodeCount}}</text>
        <text class="stat-label">核销码</text>
      </view>
    </view>
  </view>

  <!-- 审核提示信息 -->
  <view class="audit-notice" wx:if="{{userRole === 'teacher' && userStatus === 'pending'}}">
    <view class="notice-content">
      <van-icon name="info-o" size="16px" color="#ff976a" />
      <text class="notice-text">您的教师身份正在审核中，审核通过后即可使用全部功能</text>
    </view>
  </view>

  <!-- 教师信息展示 -->
  <view class="teacher-info-card" wx:if="{{userRole === 'teacher' && teacherInfo.name}}">
    <view class="card-header">
      <text class="card-title">我的教师信息</text>
      <view class="edit-btn" bindtap="showTeacherInfoForm">
        <van-icon name="edit" size="16px" color="#1989fa" />
        <text>编辑</text>
      </view>
    </view>
    <view class="teacher-details">
      <view class="detail-item">
        <text class="detail-label">姓名：</text>
        <text class="detail-value">{{teacherInfo.name}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">专长：</text>
        <text class="detail-value">{{teacherInfo.specialty}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">评分：</text>
        <text class="detail-value">{{teacherInfo.rating}}分</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">学生数：</text>
        <text class="detail-value">{{teacherInfo.studentCount}}人</text>
      </view>
      <view class="detail-item full-width" wx:if="{{teacherInfo.introduction}}">
        <text class="detail-label">个人介绍：</text>
        <text class="detail-value">{{teacherInfo.introduction}}</text>
      </view>
    </view>
  </view>

  <!-- 教师核销功能 -->
  <view class="verify-section" wx:if="{{userRole === 'teacher' && userStatus === 'approved'}}">
    <view class="section-title">课程核销</view>
    <view class="verify-card">
      <view class="verify-content">
        <van-icon name="passed" size="48rpx" color="#07c160" />
        <view class="verify-text">
          <text class="verify-title">核销学生课程</text>
          <text class="verify-desc">输入学生提供的核销码完成课程核销</text>
        </view>
      </view>
      <button class="verify-btn" bindtap="showVerifyModal">开始核销</button>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="menu-list">
      <!-- 教师信息管理 -->
      <view class="menu-item" wx:if="{{userRole === 'teacher'}}" bindtap="showTeacherInfoForm">
        <view class="menu-icon">
          <van-icon name="user-circle-o" size="20px" color="#7232dd" />
        </view>
        <text class="menu-text">教师信息管理</text>
        <van-icon name="arrow" size="14px" color="#ccc" />
      </view>

      <!-- 我的订阅 -->
      <navigator url="/pages/user/subscriptions/subscriptions" class="menu-item {{userRole === 'teacher' && userStatus === 'pending' ? 'disabled-menu' : ''}}">
        <view class="menu-icon">
          <van-icon name="orders-o" size="20px" color="#07c160" />
        </view>
        <text class="menu-text">我的订阅</text>
        <view class="menu-badge" wx:if="{{subscriptionCount > 0}}">{{subscriptionCount}}</view>
        <van-icon name="arrow" size="14px" color="#ccc" />
      </navigator>

      <!-- 我的核销码 -->
      <navigator url="/pages/user/verify-codes/verify-codes" class="menu-item {{userRole === 'teacher' && userStatus === 'pending' ? 'disabled-menu' : ''}}">
        <view class="menu-icon">
          <van-icon name="qr" size="20px" color="#1989fa" />
        </view>
        <text class="menu-text">我的核销码</text>
        <view class="menu-badge" wx:if="{{verifyCodeCount > 0}}">{{verifyCodeCount}}</view>
        <van-icon name="arrow" size="14px" color="#ccc" />
      </navigator>
    </view>
  </view>

  <!-- 核销弹窗 -->
  <view class="verify-modal" wx:if="{{showVerifyModal}}">
    <view class="modal-mask" bindtap="hideVerifyModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">课程核销</text>
        <van-icon name="cross" size="20px" color="#999" bindtap="hideVerifyModal" />
      </view>
      <view class="modal-body">
        <view class="verify-input-section">
          <text class="input-label">请输入学生提供的核销码</text>
          <input 
            class="verify-input" 
            placeholder="输入核销码" 
            value="{{verifyInput}}"
            bindinput="onVerifyInput"
            maxlength="20"
          />
        </view>
        <view class="modal-actions">
          <button class="btn-cancel" bindtap="hideVerifyModal">取消</button>
          <button class="btn-confirm" bindtap="verifyCode">确认核销</button>
        </view>
      </view>
    </view>
  </view>
</view>