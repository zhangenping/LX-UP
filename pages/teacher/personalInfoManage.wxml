<!--pages/teacher/manage/manage.wxml-->
<view class="page-container">
  <view class="header">
    <view class="header-title">教师信息管理</view>
    <view class="header-subtitle">完善您的教师资料</view>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">
    <!-- 加载状态 -->
    <view class="loading-container" wx:if="{{isLoading}}">
      <view class="loading-text">加载教师信息中...</view>
    </view>

    <view class="form-content" wx:else>
      <!-- 头像上传 -->
      <view class="form-section">
        <view class="section-title">头像</view>
        <view class="avatar-upload" bindtap="chooseAvatar">
          <image class="avatar-preview" src="{{formData.avatar || '/images/default-avatar.png'}}" mode="aspectFill" />
          <view class="avatar-mask">点击更换</view>
        </view>
      </view>

      <!-- 基本信息 -->
      <view class="form-section">
        <view class="section-title">基本信息</view>
        
        <view class="form-item">
          <view class="form-label">姓名</view>
          <input 
            class="form-input" 
            placeholder="请输入真实姓名" 
            value="{{formData.name}}"
            data-field="name"
            bindinput="onFormInput"
          />
        </view>
        
        <view class="form-item">
          <view class="form-label">教学专长</view>
          <input 
            class="form-input" 
            placeholder="例如：数学、英语、物理" 
            value="{{formData.specialty}}"
            data-field="specialty"
            bindinput="onFormInput"
          />
        </view>
      </view>

      <!-- 教学信息 -->
      <view class="form-section">
        <view class="section-title">教学信息</view>
        
        <view class="form-item">
          <view class="form-label">评分</view>
          <input 
            class="form-input" 
            type="number" 
            placeholder="1-5分" 
            value="{{formData.rating}}"
            data-field="rating"
            bindinput="onNumberInput"
            min="1"
            max="5"
          />
        </view>
        
        <view class="form-item">
          <view class="form-label">学生数量</view>
          <input 
            class="form-input" 
            type="number" 
            placeholder="学生数量" 
            value="{{formData.studentCount}}"
            data-field="studentCount"
            bindinput="onNumberInput"
          />
        </view>
      </view>

      <!-- 联系信息 -->
      <view class="form-section">
        <view class="section-title">联系信息</view>
        
        <view class="form-item">
          <view class="form-label">联系方式</view>
          <input 
            class="form-input" 
            placeholder="微信/电话等" 
            value="{{formData.contact}}"
            data-field="contact"
            bindinput="onFormInput"
          />
        </view>
      </view>

      <!-- 个人介绍 -->
      <view class="form-section">
        <view class="section-title">个人介绍</view>
        
        <view class="form-item">
          <textarea 
            class="form-textarea" 
            placeholder="请简单介绍一下您的教学经验和特点..." 
            value="{{formData.introduction}}"
            data-field="introduction"
            bindinput="onFormInput"
            maxlength="200"
          />
          <view class="textarea-counter">{{formData.introduction ? formData.introduction.length : 0}}/200</view>
        </view>
      </view>

      <!-- 新增：课程管理 -->
      <view class="form-section">
        <view class="section-title">课程管理</view>
        
        <view class="course-management">
          <button class="add-course-btn" bindtap="onShowCourseForm">+ 添加课程</button>
          
          <view class="course-list">
            <view wx:for="{{courses}}" wx:key="_id" class="course-item">
              <view class="course-info">
                <view class="course-name">{{item.name}}</view>
                <view class="course-details">
                  <text class="course-price">¥{{item.price}}</text>
                  <text class="course-hours">{{item.hours}}课时</text>
                  <text class="course-level">{{item.level}}</text>
                </view>
                <view class="course-schedule">
                  <text wx:for="{{item.schedule}}" wx:key="index" class="schedule-item">
                    {{item.day}} {{item.time}}
                  </text>
                </view>
              </view>
              <button class="delete-course-btn" bindtap="onDeleteCourse" data-id="{{item._id}}" data-name="{{item.name}}">删除</button>
            </view>
          </view>
          
          <view wx:if="{{courses.length === 0}}" class="no-courses">
            <text>暂无课程，点击上方按钮添加</text>
          </view>
        </view>
      </view>

      <!-- 添加一些空白区域确保可以滚动 -->
      <view class="spacer" style="height: 50rpx;"></view>
    </view>
  </view>

  <!-- 底部按钮 -->
  <view class="footer">
    <button class="submit-btn" bindtap="submitTeacherInfo">保存信息</button>
  </view>

  <!-- 添加课程弹窗 -->
  <view wx:if="{{showCourseForm}}" class="course-modal">
    <view class="modal-mask" bindtap="onHideCourseForm"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">添加课程</text>
        <text class="modal-close" bindtap="onHideCourseForm">×</text>
      </view>
      
      <view class="modal-body">
        <view class="modal-form-item">
          <view class="modal-label">课程名称</view>
          <input 
            class="modal-input" 
            placeholder="请输入课程名称" 
            value="{{courseFormData.name}}"
            data-field="name"
            bindinput="onCourseFormInput"
          />
        </view>
        
        <view class="modal-form-item">
          <view class="modal-label">课程描述</view>
          <textarea 
            class="modal-textarea" 
            placeholder="请输入课程描述" 
            value="{{courseFormData.description}}"
            data-field="description"
            bindinput="onCourseFormInput"
          />
        </view>
        
        <view class="modal-form-row">
          <view class="modal-form-item">
            <view class="modal-label">价格(元)</view>
            <input 
              class="modal-input" 
              type="number" 
              placeholder="0" 
              value="{{courseFormData.price}}"
              data-field="price"
              bindinput="onCourseNumberInput"
            />
          </view>
          
          <view class="modal-form-item">
            <view class="modal-label">课时</view>
            <input 
              class="modal-input" 
              type="number" 
              placeholder="0" 
              value="{{courseFormData.hours}}"
              data-field="hours"
              bindinput="onCourseNumberInput"
            />
          </view>
        </view>
        
        <view class="modal-form-item">
          <view class="modal-label">难度级别</view>
          <picker 
            value="{{courseFormData.level}}" 
            range="{{['初级', '中级', '高级']}}"
            data-field="level"
            bindchange="onCourseFormInput"
          >
            <view class="modal-picker">{{courseFormData.level}}</view>
          </picker>
        </view>
        
        <view class="modal-form-item">
          <view class="modal-label">上课时间</view>
          <view wx:for="{{courseFormData.schedule}}" wx:key="index" class="schedule-input-group">
            <picker 
              value="{{item.dayIndex}}" 
              range="{{dayOptions}}"
              data-index="{{index}}"
              data-field="day"
              bindchange="onScheduleInput"
            >
              <view class="schedule-picker">{{dayOptions[item.dayIndex]}}</view>
            </picker>
            <input 
              class="schedule-time-input" 
              placeholder="时间如: 19:00-21:00" 
              value="{{item.time}}"
              data-index="{{index}}"
              data-field="time"
              bindinput="onScheduleInput"
            />
            <text 
              wx:if="{{courseFormData.schedule.length > 1}}"
              class="remove-schedule" 
              bindtap="onRemoveSchedule"
              data-index="{{index}}"
            >删除</text>
          </view>
          <button class="add-schedule-btn" bindtap="onAddSchedule">添加时间段</button>
        </view>
        
        <button class="modal-submit-btn" bindtap="onSubmitCourse">创建课程</button>
      </view>
    </view>
  </view>
</view>